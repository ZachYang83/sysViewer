<template>
  <div class="catalog">
    <layer-tree ref="layerTree" @handleSelected="handleSelected"></layer-tree>
  </div>
</template>

<script>
import LayerTree from "@/components/common/layerTree/index.vue";
// import "echarts/extension/bmap/bmap.js";
// import BMap from "BMap";
import EchartsLayer from "utils/EchartsLayer.js";
import { getCompany } from "@/api/industry/cyl_tupu/index.js";

let echartslayer = null;
export default {
  data() {
    return {
      companyData: [],
      mark: "0-1-1-1",
    };
  },
  mounted() {
    let _this = this;
    _this.init();
    if (this.$route.params.mark) {
      this.mark = this.$route.params.mark;
      _this.$refs.layerTree.checkedKeys = [];
      _this.$refs.layerTree.checkedKeys.push(this.mark);
    }
    // echartslayer = echarts.init(document.getElementById("mapbox"));
    echartslayer = new EchartsLayer(window.MAP);
    this.initMapChart();
    this.getData(_this.mark);
  },
  components: {
    LayerTree: LayerTree,
  },
  methods: {
    init() {
      window.MAP.setCenter([113.35, 35.1]);
      window.MAP.setZoom(3);
    },
    initMapChart() {
      let _this = this;
      var option = {
        tooltip: {
          trigger: "item",
        },
        GLMap: {
          roam: false,
        },
        coordinateSystem: "GLMap",
        series: [
          {
            name: "锂产品生产基地",
            type: "scatter",
            coordinateSystem: "GLMap",
            data: _this.companyData,
            symbolSize: function (val) {
              switch (val[2]) {
                case 1:
                  return 4;
                case 2:
                  return 8;
                case 3:
                  return 12;
                case 4:
                  return 15;
                case 5:
                  return 20;
              }
            },
            symbol: function (val) {
              switch (val[2]) {
                case 1:
                  return "circle";
                case 2:
                  return "circle";
                case 3:
                  return "circle";
                case 4:
                  return "path://M938.667,426.667v-85.334c0-46.933-38.4-85.333-85.334-85.333H128c-46.933,0-85.333,38.4-85.333,85.333v341.334C42.667,729.6,81.067,768,128,768h725.333c46.934,0,85.334-38.4,85.334-85.333v-85.334c23.466,0,42.666-19.2,42.666-42.666v-85.334c0-23.466-19.2-42.666-42.666-42.666zM896,469.333v213.334c0,23.466-19.2,42.666-42.667,42.666H128c-23.467,0-42.667-19.2-42.667-42.666V341.333c0-23.466,19.2-42.666,42.667-42.666h725.333c23.467,0,42.667,19.2,42.667,42.666v128zM128,682.667h554.667V341.333H128v341.334z";
                case 5:
                  return "path://M107.789474,916.210526V449.122807h269.473684 M107.789474,934.175439c-10.778947,0-17.964912-7.185965-17.964913-17.964913V449.122807c0-10.778947,7.185965-17.964912,17.964913-17.964912h269.473684c10.778947,0,17.964912,7.185965,17.964912,17.964912s-7.185965,17.964912-17.964912,17.964912H125.754386v449.122807c0,10.778947-7.185965,17.964912-17.964912,17.964913z M736.561404,413.192982h269.473684v503.017544 M1006.035088,934.175439c-10.778947,0-17.964912-7.185965-17.964913-17.964913V431.157895H736.561404c-10.778947,0-17.964912-7.185965-17.964913-17.964913s7.185965-17.964912,17.964913-17.964912h269.473684c10.778947,0,17.964912,7.185965,17.964912,17.964912v503.017544c0,10.778947-7.185965,17.964912-17.964912,17.964913z M377.263158,287.438596h359.298246v628.77193H377.263158z M377.263158,449.122807V251.508772h359.298246v161.68421 M377.263158,467.087719c-10.778947,0-17.964912-7.185965-17.964912-17.964912V251.508772c0-10.778947,7.185965-17.964912,17.964912-17.964912h359.298246c10.778947,0,17.964912,7.185965,17.964912,17.964912v161.68421c0,10.778947-7.185965,17.964912-17.964912,17.964913s-17.964912-7.185965-17.964913-17.964913v-143.719298H395.22807v179.649123c0,10.778947-7.185965,17.964912-17.964912,17.964912z M664.701754,247.915789H449.122807V161.684211l107.789474-50.301755L664.701754,161.684211z M664.701754,265.880702H449.122807c-10.778947,0-17.964912-7.185965-17.964912-17.964913V161.684211c0-7.185965,3.592982-12.575439,10.778947-16.168422l107.789474-50.301754c5.389474-1.796491,10.778947-1.796491,14.37193,0l107.789473,50.301754c7.185965,3.592982,10.778947,8.982456,10.778948,16.168422v86.231578c0,8.982456-7.185965,17.964912-17.964913,17.964913z,m-197.614035-35.929825h179.649123V174.259649l-89.824561-41.319298-89.824562,41.319298v55.691228z M556.912281,0c10.778947,0,17.964912,7.185965,17.964912,17.964912v89.824562c0,10.778947-7.185965,17.964912-17.964912,17.964912s-17.964912-7.185965-17.964913-17.964912V17.964912c0-10.778947,7.185965-17.964912,17.964913-17.964912z M485.052632,359.298246h143.719298v161.68421h-143.719298zM485.052632,628.77193h143.719298v287.438596h-143.719298z M197.614035,520.982456h107.789474v125.754386h-107.789474zM197.614035,700.631579h107.789474v125.754386h-107.789474zM808.421053,503.017544h107.789473v125.754386h-107.789473zM808.421053,700.631579h107.789473v125.754386h-107.789473z M377.263158,431.157895h17.964912v485.052631h-17.964912zM718.596491,395.22807h17.964913v520.982456h-17.964913z M35.929825,916.210526h1041.964912c10.778947,0,17.964912,7.185965,17.964912,17.964913v53.894736c0,10.778947-7.185965,17.964912-17.964912,17.964913H35.929825c-10.778947,0-17.964912-7.185965-17.964913-17.964913v-53.894736c0-10.778947,7.185965-17.964912,17.964913-17.964913z M1077.894737,1024H35.929825c-19.761404,0-35.929825-16.168421-35.929825-35.929825v-53.894736c0-19.761404,16.168421-35.929825,35.929825-35.929825h1041.964912c19.761404,0,35.929825,16.168421,35.929824,35.929825v53.894736c0,19.761404-16.168421,35.929825-35.929824,35.929825zM35.929825,934.175439v53.894736h1041.964912v-53.894736H35.929825z";
              }
            },
            // encode: {
            //   value: 2,
            // },
            label: {
              formatter: "{b}",
              position: "right",
              show: true,
            },
            // emphasis: {
            //   label: {
            //     show: true,
            //   },
            // },
            itemStyle: {
              opacity: 0.8,
              color: function (params) {
                switch (params.value[2]) {
                  case 1:
                    return "#ffff00";
                  case 2:
                    return "#9c27b0";
                  case 3:
                    return "#ff1744";
                  case 4:
                    return "#c6ff00";
                  case 5:
                    return "#18ffff";
                }
              },
            },
          },
          {
            name: "锂电池生产基地",
            type: "effectScatter",
            coordinateSystem: "GLMap",
            data: _this.companyData.filter((item) => {
              return item["value"][2] === 5;
            }),
            symbolSize: function (val) {
              return 20;
            },
            symbol:
              "path://M107.789474,916.210526V449.122807h269.473684 M107.789474,934.175439c-10.778947,0-17.964912-7.185965-17.964913-17.964913V449.122807c0-10.778947,7.185965-17.964912,17.964913-17.964912h269.473684c10.778947,0,17.964912,7.185965,17.964912,17.964912s-7.185965,17.964912-17.964912,17.964912H125.754386v449.122807c0,10.778947-7.185965,17.964912-17.964912,17.964913z M736.561404,413.192982h269.473684v503.017544 M1006.035088,934.175439c-10.778947,0-17.964912-7.185965-17.964913-17.964913V431.157895H736.561404c-10.778947,0-17.964912-7.185965-17.964913-17.964913s7.185965-17.964912,17.964913-17.964912h269.473684c10.778947,0,17.964912,7.185965,17.964912,17.964912v503.017544c0,10.778947-7.185965,17.964912-17.964912,17.964913z M377.263158,287.438596h359.298246v628.77193H377.263158z M377.263158,449.122807V251.508772h359.298246v161.68421 M377.263158,467.087719c-10.778947,0-17.964912-7.185965-17.964912-17.964912V251.508772c0-10.778947,7.185965-17.964912,17.964912-17.964912h359.298246c10.778947,0,17.964912,7.185965,17.964912,17.964912v161.68421c0,10.778947-7.185965,17.964912-17.964912,17.964913s-17.964912-7.185965-17.964913-17.964913v-143.719298H395.22807v179.649123c0,10.778947-7.185965,17.964912-17.964912,17.964912z M664.701754,247.915789H449.122807V161.684211l107.789474-50.301755L664.701754,161.684211z M664.701754,265.880702H449.122807c-10.778947,0-17.964912-7.185965-17.964912-17.964913V161.684211c0-7.185965,3.592982-12.575439,10.778947-16.168422l107.789474-50.301754c5.389474-1.796491,10.778947-1.796491,14.37193,0l107.789473,50.301754c7.185965,3.592982,10.778947,8.982456,10.778948,16.168422v86.231578c0,8.982456-7.185965,17.964912-17.964913,17.964913z,m-197.614035-35.929825h179.649123V174.259649l-89.824561-41.319298-89.824562,41.319298v55.691228z M556.912281,0c10.778947,0,17.964912,7.185965,17.964912,17.964912v89.824562c0,10.778947-7.185965,17.964912-17.964912,17.964912s-17.964912-7.185965-17.964913-17.964912V17.964912c0-10.778947,7.185965-17.964912,17.964913-17.964912z M485.052632,359.298246h143.719298v161.68421h-143.719298zM485.052632,628.77193h143.719298v287.438596h-143.719298z M197.614035,520.982456h107.789474v125.754386h-107.789474zM197.614035,700.631579h107.789474v125.754386h-107.789474zM808.421053,503.017544h107.789473v125.754386h-107.789473zM808.421053,700.631579h107.789473v125.754386h-107.789473z M377.263158,431.157895h17.964912v485.052631h-17.964912zM718.596491,395.22807h17.964913v520.982456h-17.964913z M35.929825,916.210526h1041.964912c10.778947,0,17.964912,7.185965,17.964912,17.964913v53.894736c0,10.778947-7.185965,17.964912-17.964912,17.964913H35.929825c-10.778947,0-17.964912-7.185965-17.964913-17.964913v-53.894736c0-10.778947,7.185965-17.964912,17.964913-17.964913z M1077.894737,1024H35.929825c-19.761404,0-35.929825-16.168421-35.929825-35.929825v-53.894736c0-19.761404,16.168421-35.929825,35.929825-35.929825h1041.964912c19.761404,0,35.929825,16.168421,35.929824,35.929825v53.894736c0,19.761404-16.168421,35.929825-35.929824,35.929825zM35.929825,934.175439v53.894736h1041.964912v-53.894736H35.929825z",
            // encode: {
            //   value: 2,
            // },
            showEffectOn: "render",
            rippleEffect: {
              brushType: "stroke",
            },
            label: {
              formatter: "{b}",
              position: "right",
              show: true,
            },
            itemStyle: {
              color: "#18ffff",
              shadowBlur: 10,
              shadowColor: "#333",
            },
            emphasis: {
              scale: true,
            },
            zlevel: 1,
          },
        ],
      };
      // echartslayer = new EchartsLayer(window.MAP);
      echartslayer.chart.setOption(option);
    },
    handleSelected(key) {
      this.getData(key);
    },
    getData(key) {
      let _this = this;
      getCompany("/fgw_yxjc/yxjc-chanyelian/getCompany", { mark: key }).then(
        (res) => {
          _this.companyData = [];
          var companies = res.data.data;
          for (let index in companies) {
            var obj = {
              name: companies[index].name,
              value: [
                companies[index].lon,
                companies[index].lat,
                companies[index].grade,
              ],
            };
            _this.companyData.push(obj);
          }
          console.log(_this.companyData, "companies");
          _this.initMapChart();
        }
      );
    },
  },
  destroyed() {
    echartslayer.remove();
    window.MAP.setCenter([113.35, 23.1]);
  },
};
</script>


<style lang="scss" scoped>
.catalog {
  position: absolute;
  top: 35px;
  right: 5px;
  width: 350px;
  height: calc(100% - 50px);
  z-index: 9999;
  background: url("./img/catalog.png") 100% 100% no-repeat;
  overflow-y: hidden;
}
</style>

<style>
.mtree-box .tree-box{
  border-top:0px !important;
}
</style>